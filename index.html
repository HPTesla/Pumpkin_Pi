<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="style.css" />
<!--    <link href="google-code-prettify/prettify.css" type="text/css" rel="stylesheet" /> -->
    <link rel="stylesheet" type="text/css" href="sunburst.css" />
    <script type="text/javascript" src="google-code-prettify/prettify.js"></script>
    <title>Pumpkin Pi</title>
    <meta name="Description" content="A very easy beginners project to illuminate a Jack-o'Lantern using LEDs and Raspberry Pi.">
  </head>
  <body onload="prettyPrint()">
    <div class="navbar">
      <h1>Pumpkin Pi</h1>
      <div id="ribbon"><a href="https://github.com/begillespie/Pumpkin_Pi">Fork me on GitHub</a></div>
    </div>
    <div class="container">
      <div class="sidebar_left">
        <p class="tagline">Illuminate a Jack-o'-Lantern using LEDs and Raspberry Pi.</p><hr>
        <ul class="contents">
          <li><a href="#overview">Overview</a></li>
          <li><a href="#circuits">Circuits</a></li>
          <li><a href="#code">Code</a></li>
          <li><a href="#pumpkin">Pumpkin</a></li>
          <li><a href="#result">Result</a></li>
        </ul>
        <ul class="raspi">
          <li><a href="http://www.raspberrypi.org"><img src="./Images/Raspi_Colour_R.png" height="60px" title="Raspberry Pi is a trademark of the Raspberry Pi Foundation"/></a></li>
          <li>Runs on Raspberry Pi</li>
        </ul>
      </div>
      
      <div class="content">
        <div class="image-right"><img width="300px" src="./Images/PumpkinPiTerminal.PNG"/><div class="caption">For when you're feeling just a little old school</div></div>
        <h2 id="overview">Overview<hr></h2>
        <div class="build-text">
          <p>Some dozen years ago, I very nearly failed a 200-level Electrical Engineering course. More than fifteen years ago was the last time I did much programming. In FORTRAN. This is my guide to making a Raspberry Pi-powered interactive Jack-o'-Lantern from my completely novice perspective.</p>
          <p>Why a Raspberry Pi? Well, it's all the rage right now, and, while an Arduino is probably a better choice here, a Pi was what I had. And we all know what they say about what to do when <a href="http://en.wiktionary.org/wiki/if_all_you_have_is_a_hammer,_everything_looks_like_a_nail">all you have is a hammer</a>. Also, I've been working on learning <a href="http://www.codecademy.com/tracks/python">Python</a> lately, so using the Pi was a good way to put what I've been learning to use.</p>
          <p>I'll walk through building the <a href="#circuits">circuits</a>, writing the <a href="#code">code</a>, and putting it all together into a <a href="#pumpkin">pumpkin</a> before we admire the final <a href="#result">result</a>.</p>
        </div>
        <div class="image-center"><img src="./Images/PumpkinPi5.jpg"/><div class="caption">Jack Skellington, the Pumpkin King</div></div>

        <h2 id="circuits">Build Some Circuits<hr></h2>
        <div class="build-text">
          <p>I built everything onto two breadboards. The breakout board connects to the GPIO headers through the Adafruit Pi Cobbler Kit and the remote board is inside the pumpkin and holds the lights and motion sensor. The remote board is tethered by a piece of CAT-5e cable with the ends cut off. By using two boards this way, I can keep the Raspberry Pi and main board inside and run the cable out the window to the pumpkin on the porch.</p>
          <p>The Raspberry Pi provides 3.3V and 5V power. The 5V pin is connected to the bottom rail to power the PIR. Each LED is connected to a GPIO pin that provides 3.3V when switched on.</p>
          <div class="image-right"><a href="./Images/PumpkinPi4.jpg"><img src="./Images/PumpkinPi4_300px.jpg"/></a><div class="caption">Setting up to test the PIR</div></div>
          Components used:
          <ul>
            <li><a href="http://www.raspberrypi.org">Raspberry Pi</a></li>
            <li><a href="http://adafruit.com/products/914">Adafruit Pi Cobbler Breakout Kit</a></li>
            <li><a href="http://adafruit.com/products/189">PIR (motion) sensor</a></li>
            <li>Quarter-sized and Half-sized breadboards</li>
            <li>2 White 10mm LEDs</li>
            <li>2 Red 5mm LEDs</li>
            <li>Amber 5mm LED</li>
            <li>Resistors</li>
          </ul>
          <p>Some of the specifics on the parts list were driven by what I had on hand. I have four circuits for LEDs on pins 22, 23, 24 and 25. For a brighter red glow, I put two red LEDs together on one circuit. They are wired in parallel so each sees 3.3V for maximum brightness. Each individual LED also has a current limiting resistor.</p>
          <p>The PIR wiring is very simple. It has 3 connections: ground, +5V and signal. My signal wire connects to pin 17 and the whole PIR is on a 12 inch lead so I can position it for best coverage. When the PIR senses motion, it sends out 3.3V on the signal wire for a little over a second. The Raspberry Pi interprets that as <code class="prettyprint">True</code>. To test using the PIR to trigger an action, I connected the PIR to pin 17, an LED to pin 22, and ran this script. All it does is listen for the PIR on pin 17. When a voltage is detected, it prints a message to the terminal and turns on the light. The <code class="prettyprint">while True:</code> statement will cause this loop to run forever. To exit this quick test, wait until the LED is off and hit Ctrl-C. In the picture, only the resistor in the middle is part of the circuit. The other two were sitting in the board for something else and I just forgot to take them off before taking the picture.</p>
<pre class="prettyprint">
import RPi.GPIO as GPIO, time

GPIO.setmode(GPIO.BCM)      # Set up
GPIO.setup(22, GPIO.OUT)
GPIO.setup(17, GPIO.IN)

GPIO.output(22, True)       # Turn the light on to confirm it's working
time.sleep(5)
GPIO.output(22, False)
time.sleep(5)

while True:
    if GPIO.input(17):        # Listen for the PIR on pin 17
        print "Motion Sensor"
        GPIO.output(22, True)
        time.sleep(10)
        GPIO.output(22, False)
</pre>
          <p>A quick note about the GPIO pins on the Raspberry Pi: They are digital, which means that they are all or nothing, high or low, on or off, <code class="prettyprint">True</code> or <code class="prettyprint">False</code>. The correlation between what is happening in the code and physically, on the Pi, is that <code class="prettyprint">True</code> equals +3.3V on the GPIO pin and <code class="prettyprint">False</code> equals no voltage on the pin.</p>
        </div>
        <div class="image-center"><a href="./Images/PumpkinPi1.jpg"><img width="800px" src="./Images/PumpkinPi1_800px.jpg"/></a><div class="caption">Pumpkin Pi on the bench</div></div>
        <h2 id="code">Write Some Code<hr></h2>
        <div class="build-text">
          <p>The code is in Python and posted on <a href="https://github.com/begillespie/pumpkin_pi">GitHub</a>. You'll need to make sure you have the <a href="http://code.google.com/p/raspberry-gpio-python">RPi.GPIO</a> library installed and up to date. The first thing to do is import some modules and set up the board and motion sensor.</p>
            <pre class="prettyprint">
import RPi.GPIO as GPIO, random, signal, sys, time, bigletters

GPIO.setmode(GPIO.BCM)
GPIO.setwarnings(False)
motionsensor = 17
GPIO.setup(motionsensor, GPIO.IN)</pre>
          <div class="image-right"><a href="./Images/PumpkinPi3.jpg"><img src="./Images/PumpkinPi3_300px.jpg"/></a><div class="caption">The remote board</div></div>
          <p>The bigletters module is something I wrote that prints short messages to the terminal using ASCII art characters.</p>
          <p> Next is the LED class.</p>
            <pre class="prettyprint">
class LED:
    '''Access the LEDs with some simple methods.'''
    def __init__(self, pin):
        self.pin = pin
        leds.append(self)
        GPIO.setup(self.pin, GPIO.OUT)
    def on(self):
        GPIO.output(self.pin, True)
    def off(self):
        GPIO.output(self.pin, False)</pre>

          <p>This allows me to create an instance of an LED with a descriptive name and pin number and forget about it.</p>

<pre class="prettyprint">RedLED = LED(23)</pre>

          <p>Now, to turn on the red LED, just call <code class="prettyprint">RedLED.on()</code>. The object also adds itself to a running list of all instances when it is created, to make it easy to perform an action on all of the LEDs attached to the system.<p>

            <pre class="prettyprint">
def pumpkin_pi_on():
    for i in range(len(leds)):
        leds[i].on()</pre>

          <p>I defined a handful of lighting patterns using some <code class="prettyprint">for:</code> loops to keep the code small. To make the program pause, use <code class="prettyprint">time.sleep(t)</code> where t is the length of the delay in seconds. Each sequence lasts around two or three seconds.</p>

            <pre class="prettyprint">
def flash_1():
    for i in range(6):
        pumpkin_pi_on()
        time.sleep(.25)
        pumpkin_pi_off()
        time.sleep(.25)</pre>

          <p>The main program flow involves a few branching for loops that string together a relatively small number of animations to make it look more random. Every iteration of the main loop checks if the allotted running time is up, then checks the motion sensor before randomly choosing a blink pattern.</p>

            <pre class="prettyprint">
def pumpkin_pi(stopTime):
    while stopTime > time.time():
        if GPIO.input(motionsensor):
            motion_sequence()
    else:
        random.choice(flash_patterns)()
        pumpkin_pi_off()
  pumpkin_pi_quit()</pre>

          <p>The <code class="prettyprint">while</code> loop will execute the code inside the loop as long as the condition is <code class="prettyprint">True</code> For randomly branching to different functions, I found this piece of code fascinating:</p>

            <pre class="prettyprint">
list_of_functions=[func_1, func_2, func_3]
random.choice(list_of_functions)()</pre>

          <p>So, given a list of function names, <code class="prettyprint">random.choice()</code> will pick one, pass it the arguments <code class="prettyprint">()</code> and execute it. This condenses a teetering tower of <code class="prettyprint">if:</code> / <code class="prettyprint">elif:</code> statements down to two lines.</p>

          <p>That's the bulk of the code. There is a <code class="prettyprint">main()</code> function to get things moving and some window dressing for the terminal. There is also a signal handler to catch Ctrl+C from the keyboard and trigger a nice shutdown. To get things running from the command line, make sure it is executable:</p>

<pre class="prettyprint">chmod +x pumpkinPi.py</pre>

          <p>And run it as root with a duration argument to tell it how long you want the pumpkin to run. The GPIO library requires root to get to the GPIO pins on the Raspberry Pi. To run for one hour:</p>

<pre class="prettyprint">sudo ./pumpkinPi.py 01:00</pre>
          <p>The command line has two options: -v for verbose, where every subordinate function announces itself to the console when it runs. Debug mode is activated with -d and allows you to manually run sequences.</p>
        </div>

        <h2 id="pumpkin">Make a Pumpkin<hr></h2>
        <div class="build-text">
          <p>I chose a medium sized pumpkin, something small enough that the LEDs can adequately light it. Carve it up and add holes for the Cat-5 tether cable and the PIR wires. I used this chart to keep track of the wires from the GPIO through the terminal block. Using Cat 5e cable was convenient for packaging eight wires together, but added complexity to track what goes where. Terminal 1 is the one at the top of the picture.</p>
          <div class="image-right"><a href="./Images/PumpkinPi2.jpg"><img src="./Images/PumpkinPi2_300px.jpg"/></a><div class="caption">The breakout board and terminal block</div></div>

          <table>
            <tr><th>Circuit</th><th>GPIO</th><th>Wire Color</th><th>Terminal</th><th>Cat 5 Color</th></tr>
            <tr><td>Red LED</td><td>23</td><td>Green</td><td>1</td><td>Green</td></tr>
            <tr><td>Amber LED</td><td>22</td><td>Orange</td><td>2</td><td>Green/Stripe</td></tr>
            <tr><td>White1 LED</td><td>24</td><td>White</td><td>3</td><td>Orange</td></tr>
            <tr><td>White2 LED</td><td>25</td><td>Blue</td><td>4</td><td>Orange/Stripe</td></tr>
            <tr><td>PIR Signal</td><td>17</td><td>Yellow</td><td>5</td><td>Brown</td></tr>
            <tr><td>+5V</td><td>--</td><td>Red</td><td>7</td><td>Purple</td></tr>
            <tr><td>GND</td><td>--</td><td>Black</td><td>8</td><td>Brown/Stripe</td></tr>
          </table>
          <div class="image-right"><a href="./Images/PumpkinPi6.jpg"><img src="./Images/PumpkinPi6_300px.jpg"/></a><div class="caption">The remote board in place</div></div>
          <p>I hadn't really thought about what I was going to actually carve until I was looking at the hollowed-out pumpkin, knife in hand. Jack Skellington crossed my mind, so I looked up some pictures, sketched it out with a dry erase marker, and cut away. I set the remote board inside of a short drinking glass to insulate it from pumpkin goop. I think it turned out pretty good. I am quite pleased with how well the LEDs light up the jack-o'-lantern. They are performing far better than I had hoped. I particularly like how the red LEDs fill the volume of the pumpkin. The two big white LEDs produce an extra bright blowout, and the amber provides a touch of warmth.</p>
          <p>I'll call this Version 1.0 of Pumpkin Pi. Next year, I might revisit this to scale up the LED array, use RG-45 jacks to connect the boards, figure out some more advanced sequences and add a better interface.</p>
        </div>
        <h2 id="result">The Result<hr></h2>
        <iframe class="image-center" width="853" height="480" src="http://www.youtube.com/embed/XOJ01TRHTFc" frameborder="0" allowfullscreen></iframe>
      </div>
    </div>
    <div class="footer">
      <ul>
        <li>by Brian Gillespie, 2012</li>
        <li>all photos by Brian Gillespie</li>
        <li>Raspberry Pi is a trademark of the <a href="http://www.raspberrypi.org">Raspberry Pi Foundation</a></li>
      </ul>
    </div>
  </body>
</html>

